import G from"./__vite-browser-external-BIHI7g3E.js";function vr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Qe={},_e={},yt;function wr(){if(yt)return _e;yt=1,_e.byteLength=l,_e.toByteArray=_,_e.fromByteArray=b;for(var n=[],r=[],i=typeof Uint8Array<"u"?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0,u=o.length;f<u;++f)n[f]=o[f],r[o.charCodeAt(f)]=f;r[45]=62,r[95]=63;function h(g){var x=g.length;if(x%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var w=g.indexOf("=");w===-1&&(w=x);var S=w===x?0:4-w%4;return[w,S]}function l(g){var x=h(g),w=x[0],S=x[1];return(w+S)*3/4-S}function m(g,x,w){return(x+w)*3/4-w}function _(g){var x,w=h(g),S=w[0],F=w[1],C=new i(m(g,S,F)),L=0,D=F>0?S-4:S,U;for(U=0;U<D;U+=4)x=r[g.charCodeAt(U)]<<18|r[g.charCodeAt(U+1)]<<12|r[g.charCodeAt(U+2)]<<6|r[g.charCodeAt(U+3)],C[L++]=x>>16&255,C[L++]=x>>8&255,C[L++]=x&255;return F===2&&(x=r[g.charCodeAt(U)]<<2|r[g.charCodeAt(U+1)]>>4,C[L++]=x&255),F===1&&(x=r[g.charCodeAt(U)]<<10|r[g.charCodeAt(U+1)]<<4|r[g.charCodeAt(U+2)]>>2,C[L++]=x>>8&255,C[L++]=x&255),C}function v(g){return n[g>>18&63]+n[g>>12&63]+n[g>>6&63]+n[g&63]}function y(g,x,w){for(var S,F=[],C=x;C<w;C+=3)S=(g[C]<<16&16711680)+(g[C+1]<<8&65280)+(g[C+2]&255),F.push(v(S));return F.join("")}function b(g){for(var x,w=g.length,S=w%3,F=[],C=16383,L=0,D=w-S;L<D;L+=C)F.push(y(g,L,L+C>D?D:L+C));return S===1?(x=g[w-1],F.push(n[x>>2]+n[x<<4&63]+"==")):S===2&&(x=(g[w-2]<<8)+g[w-1],F.push(n[x>>10]+n[x>>4&63]+n[x<<2&63]+"=")),F.join("")}return _e}var Fe={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var gt;function xr(){return gt||(gt=1,Fe.read=function(n,r,i,o,f){var u,h,l=f*8-o-1,m=(1<<l)-1,_=m>>1,v=-7,y=i?f-1:0,b=i?-1:1,g=n[r+y];for(y+=b,u=g&(1<<-v)-1,g>>=-v,v+=l;v>0;u=u*256+n[r+y],y+=b,v-=8);for(h=u&(1<<-v)-1,u>>=-v,v+=o;v>0;h=h*256+n[r+y],y+=b,v-=8);if(u===0)u=1-_;else{if(u===m)return h?NaN:(g?-1:1)*(1/0);h=h+Math.pow(2,o),u=u-_}return(g?-1:1)*h*Math.pow(2,u-o)},Fe.write=function(n,r,i,o,f,u){var h,l,m,_=u*8-f-1,v=(1<<_)-1,y=v>>1,b=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=o?0:u-1,x=o?1:-1,w=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(l=isNaN(r)?1:0,h=v):(h=Math.floor(Math.log(r)/Math.LN2),r*(m=Math.pow(2,-h))<1&&(h--,m*=2),h+y>=1?r+=b/m:r+=b*Math.pow(2,1-y),r*m>=2&&(h++,m/=2),h+y>=v?(l=0,h=v):h+y>=1?(l=(r*m-1)*Math.pow(2,f),h=h+y):(l=r*Math.pow(2,y-1)*Math.pow(2,f),h=0));f>=8;n[i+g]=l&255,g+=x,l/=256,f-=8);for(h=h<<f|l,_+=f;_>0;n[i+g]=h&255,g+=x,h/=256,_-=8);n[i+g-x]|=w*128}),Fe}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var vt;function Er(){return vt||(vt=1,function(n){"use strict";var r=wr(),i=xr(),o=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=l,n.SlowBuffer=C,n.INSPECT_MAX_BYTES=50;var f=2147483647;n.kMaxLength=f,l.TYPED_ARRAY_SUPPORT=u(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function u(){try{var s=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(s,e),s.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function h(s){if(s>f)throw new RangeError('The value "'+s+'" is invalid for option "size"');var e=new Uint8Array(s);return Object.setPrototypeOf(e,l.prototype),e}function l(s,e,t){if(typeof s=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return y(s)}return m(s,e,t)}l.poolSize=8192;function m(s,e,t){if(typeof s=="string")return b(s,e);if(ArrayBuffer.isView(s))return x(s);if(s==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s);if(z(s,ArrayBuffer)||s&&z(s.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(z(s,SharedArrayBuffer)||s&&z(s.buffer,SharedArrayBuffer)))return w(s,e,t);if(typeof s=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var a=s.valueOf&&s.valueOf();if(a!=null&&a!==s)return l.from(a,e,t);var c=S(s);if(c)return c;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof s[Symbol.toPrimitive]=="function")return l.from(s[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s)}l.from=function(s,e,t){return m(s,e,t)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array);function _(s){if(typeof s!="number")throw new TypeError('"size" argument must be of type number');if(s<0)throw new RangeError('The value "'+s+'" is invalid for option "size"')}function v(s,e,t){return _(s),s<=0?h(s):e!==void 0?typeof t=="string"?h(s).fill(e,t):h(s).fill(e):h(s)}l.alloc=function(s,e,t){return v(s,e,t)};function y(s){return _(s),h(s<0?0:F(s)|0)}l.allocUnsafe=function(s){return y(s)},l.allocUnsafeSlow=function(s){return y(s)};function b(s,e){if((typeof e!="string"||e==="")&&(e="utf8"),!l.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var t=L(s,e)|0,a=h(t),c=a.write(s,e);return c!==t&&(a=a.slice(0,c)),a}function g(s){for(var e=s.length<0?0:F(s.length)|0,t=h(e),a=0;a<e;a+=1)t[a]=s[a]&255;return t}function x(s){if(z(s,Uint8Array)){var e=new Uint8Array(s);return w(e.buffer,e.byteOffset,e.byteLength)}return g(s)}function w(s,e,t){if(e<0||s.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(s.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');var a;return e===void 0&&t===void 0?a=new Uint8Array(s):t===void 0?a=new Uint8Array(s,e):a=new Uint8Array(s,e,t),Object.setPrototypeOf(a,l.prototype),a}function S(s){if(l.isBuffer(s)){var e=F(s.length)|0,t=h(e);return t.length===0||s.copy(t,0,0,e),t}if(s.length!==void 0)return typeof s.length!="number"||Je(s.length)?h(0):g(s);if(s.type==="Buffer"&&Array.isArray(s.data))return g(s.data)}function F(s){if(s>=f)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+f.toString(16)+" bytes");return s|0}function C(s){return+s!=s&&(s=0),l.alloc(+s)}l.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==l.prototype},l.compare=function(e,t){if(z(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),z(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var a=e.length,c=t.length,p=0,d=Math.min(a,c);p<d;++p)if(e[p]!==t[p]){a=e[p],c=t[p];break}return a<c?-1:c<a?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return l.alloc(0);var a;if(t===void 0)for(t=0,a=0;a<e.length;++a)t+=e[a].length;var c=l.allocUnsafe(t),p=0;for(a=0;a<e.length;++a){var d=e[a];if(z(d,Uint8Array))p+d.length>c.length?l.from(d).copy(c,p):Uint8Array.prototype.set.call(c,d,p);else if(l.isBuffer(d))d.copy(c,p);else throw new TypeError('"list" argument must be an Array of Buffers');p+=d.length}return c};function L(s,e){if(l.isBuffer(s))return s.length;if(ArrayBuffer.isView(s)||z(s,ArrayBuffer))return s.byteLength;if(typeof s!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof s);var t=s.length,a=arguments.length>2&&arguments[2]===!0;if(!a&&t===0)return 0;for(var c=!1;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return Ze(s).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return dt(s).length;default:if(c)return a?-1:Ze(s).length;e=(""+e).toLowerCase(),c=!0}}l.byteLength=L;function D(s,e,t){var a=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(s||(s="utf8");;)switch(s){case"hex":return pe(this,e,t);case"utf8":case"utf-8":return $(this,e,t);case"ascii":return Xe(this,e,t);case"latin1":case"binary":return ke(this,e,t);case"base64":return k(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ke(this,e,t);default:if(a)throw new TypeError("Unknown encoding: "+s);s=(s+"").toLowerCase(),a=!0}}l.prototype._isBuffer=!0;function U(s,e,t){var a=s[e];s[e]=s[t],s[t]=a}l.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)U(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)U(this,t,t+3),U(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)U(this,t,t+7),U(this,t+1,t+6),U(this,t+2,t+5),U(this,t+3,t+4);return this},l.prototype.toString=function(){var e=this.length;return e===0?"":arguments.length===0?$(this,0,e):D.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:l.compare(this,e)===0},l.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},o&&(l.prototype[o]=l.prototype.inspect),l.prototype.compare=function(e,t,a,c,p){if(z(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),a===void 0&&(a=e?e.length:0),c===void 0&&(c=0),p===void 0&&(p=this.length),t<0||a>e.length||c<0||p>this.length)throw new RangeError("out of range index");if(c>=p&&t>=a)return 0;if(c>=p)return-1;if(t>=a)return 1;if(t>>>=0,a>>>=0,c>>>=0,p>>>=0,this===e)return 0;for(var d=p-c,T=a-t,O=Math.min(d,T),N=this.slice(c,p),V=e.slice(t,a),A=0;A<O;++A)if(N[A]!==V[A]){d=N[A],T=V[A];break}return d<T?-1:T<d?1:0};function ee(s,e,t,a,c){if(s.length===0)return-1;if(typeof t=="string"?(a=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,Je(t)&&(t=c?0:s.length-1),t<0&&(t=s.length+t),t>=s.length){if(c)return-1;t=s.length-1}else if(t<0)if(c)t=0;else return-1;if(typeof e=="string"&&(e=l.from(e,a)),l.isBuffer(e))return e.length===0?-1:te(s,e,t,a,c);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?c?Uint8Array.prototype.indexOf.call(s,e,t):Uint8Array.prototype.lastIndexOf.call(s,e,t):te(s,[e],t,a,c);throw new TypeError("val must be string, number or Buffer")}function te(s,e,t,a,c){var p=1,d=s.length,T=e.length;if(a!==void 0&&(a=String(a).toLowerCase(),a==="ucs2"||a==="ucs-2"||a==="utf16le"||a==="utf-16le")){if(s.length<2||e.length<2)return-1;p=2,d/=2,T/=2,t/=2}function O(_t,mt){return p===1?_t[mt]:_t.readUInt16BE(mt*p)}var N;if(c){var V=-1;for(N=t;N<d;N++)if(O(s,N)===O(e,V===-1?0:N-V)){if(V===-1&&(V=N),N-V+1===T)return V*p}else V!==-1&&(N-=N-V),V=-1}else for(t+T>d&&(t=d-T),N=t;N>=0;N--){for(var A=!0,Oe=0;Oe<T;Oe++)if(O(s,N+Oe)!==O(e,Oe)){A=!1;break}if(A)return N}return-1}l.prototype.includes=function(e,t,a){return this.indexOf(e,t,a)!==-1},l.prototype.indexOf=function(e,t,a){return ee(this,e,t,a,!0)},l.prototype.lastIndexOf=function(e,t,a){return ee(this,e,t,a,!1)};function ne(s,e,t,a){t=Number(t)||0;var c=s.length-t;a?(a=Number(a),a>c&&(a=c)):a=c;var p=e.length;a>p/2&&(a=p/2);for(var d=0;d<a;++d){var T=parseInt(e.substr(d*2,2),16);if(Je(T))return d;s[t+d]=T}return d}function he(s,e,t,a){return Ce(Ze(e,s.length-t),s,t,a)}function ze(s,e,t,a){return Ce(mr(e),s,t,a)}function E(s,e,t,a){return Ce(dt(e),s,t,a)}function B(s,e,t,a){return Ce(yr(e,s.length-t),s,t,a)}l.prototype.write=function(e,t,a,c){if(t===void 0)c="utf8",a=this.length,t=0;else if(a===void 0&&typeof t=="string")c=t,a=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(a)?(a=a>>>0,c===void 0&&(c="utf8")):(c=a,a=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var p=this.length-t;if((a===void 0||a>p)&&(a=p),e.length>0&&(a<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");c||(c="utf8");for(var d=!1;;)switch(c){case"hex":return ne(this,e,t,a);case"utf8":case"utf-8":return he(this,e,t,a);case"ascii":case"latin1":case"binary":return ze(this,e,t,a);case"base64":return E(this,e,t,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,e,t,a);default:if(d)throw new TypeError("Unknown encoding: "+c);c=(""+c).toLowerCase(),d=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function k(s,e,t){return e===0&&t===s.length?r.fromByteArray(s):r.fromByteArray(s.slice(e,t))}function $(s,e,t){t=Math.min(s.length,t);for(var a=[],c=e;c<t;){var p=s[c],d=null,T=p>239?4:p>223?3:p>191?2:1;if(c+T<=t){var O,N,V,A;switch(T){case 1:p<128&&(d=p);break;case 2:O=s[c+1],(O&192)===128&&(A=(p&31)<<6|O&63,A>127&&(d=A));break;case 3:O=s[c+1],N=s[c+2],(O&192)===128&&(N&192)===128&&(A=(p&15)<<12|(O&63)<<6|N&63,A>2047&&(A<55296||A>57343)&&(d=A));break;case 4:O=s[c+1],N=s[c+2],V=s[c+3],(O&192)===128&&(N&192)===128&&(V&192)===128&&(A=(p&15)<<18|(O&63)<<12|(N&63)<<6|V&63,A>65535&&A<1114112&&(d=A))}}d===null?(d=65533,T=1):d>65535&&(d-=65536,a.push(d>>>10&1023|55296),d=56320|d&1023),a.push(d),c+=T}return P(a)}var Z=4096;function P(s){var e=s.length;if(e<=Z)return String.fromCharCode.apply(String,s);for(var t="",a=0;a<e;)t+=String.fromCharCode.apply(String,s.slice(a,a+=Z));return t}function Xe(s,e,t){var a="";t=Math.min(s.length,t);for(var c=e;c<t;++c)a+=String.fromCharCode(s[c]&127);return a}function ke(s,e,t){var a="";t=Math.min(s.length,t);for(var c=e;c<t;++c)a+=String.fromCharCode(s[c]);return a}function pe(s,e,t){var a=s.length;(!e||e<0)&&(e=0),(!t||t<0||t>a)&&(t=a);for(var c="",p=e;p<t;++p)c+=gr[s[p]];return c}function Ke(s,e,t){for(var a=s.slice(e,t),c="",p=0;p<a.length-1;p+=2)c+=String.fromCharCode(a[p]+a[p+1]*256);return c}l.prototype.slice=function(e,t){var a=this.length;e=~~e,t=t===void 0?a:~~t,e<0?(e+=a,e<0&&(e=0)):e>a&&(e=a),t<0?(t+=a,t<0&&(t=0)):t>a&&(t=a),t<e&&(t=e);var c=this.subarray(e,t);return Object.setPrototypeOf(c,l.prototype),c};function R(s,e,t){if(s%1!==0||s<0)throw new RangeError("offset is not uint");if(s+e>t)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,a){e=e>>>0,t=t>>>0,a||R(e,t,this.length);for(var c=this[e],p=1,d=0;++d<t&&(p*=256);)c+=this[e+d]*p;return c},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,a){e=e>>>0,t=t>>>0,a||R(e,t,this.length);for(var c=this[e+--t],p=1;t>0&&(p*=256);)c+=this[e+--t]*p;return c},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e=e>>>0,t||R(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||R(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||R(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||R(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||R(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,a){e=e>>>0,t=t>>>0,a||R(e,t,this.length);for(var c=this[e],p=1,d=0;++d<t&&(p*=256);)c+=this[e+d]*p;return p*=128,c>=p&&(c-=Math.pow(2,8*t)),c},l.prototype.readIntBE=function(e,t,a){e=e>>>0,t=t>>>0,a||R(e,t,this.length);for(var c=t,p=1,d=this[e+--c];c>0&&(p*=256);)d+=this[e+--c]*p;return p*=128,d>=p&&(d-=Math.pow(2,8*t)),d},l.prototype.readInt8=function(e,t){return e=e>>>0,t||R(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]},l.prototype.readInt16LE=function(e,t){e=e>>>0,t||R(e,2,this.length);var a=this[e]|this[e+1]<<8;return a&32768?a|4294901760:a},l.prototype.readInt16BE=function(e,t){e=e>>>0,t||R(e,2,this.length);var a=this[e+1]|this[e]<<8;return a&32768?a|4294901760:a},l.prototype.readInt32LE=function(e,t){return e=e>>>0,t||R(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e=e>>>0,t||R(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return e=e>>>0,t||R(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e=e>>>0,t||R(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||R(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||R(e,8,this.length),i.read(this,e,!1,52,8)};function j(s,e,t,a,c,p){if(!l.isBuffer(s))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>c||e<p)throw new RangeError('"value" argument is out of bounds');if(t+a>s.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,a,c){if(e=+e,t=t>>>0,a=a>>>0,!c){var p=Math.pow(2,8*a)-1;j(this,e,t,a,p,0)}var d=1,T=0;for(this[t]=e&255;++T<a&&(d*=256);)this[t+T]=e/d&255;return t+a},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,a,c){if(e=+e,t=t>>>0,a=a>>>0,!c){var p=Math.pow(2,8*a)-1;j(this,e,t,a,p,0)}var d=a-1,T=1;for(this[t+d]=e&255;--d>=0&&(T*=256);)this[t+d]=e/T&255;return t+a},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,a){return e=+e,t=t>>>0,a||j(this,e,t,1,255,0),this[t]=e&255,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,a){return e=+e,t=t>>>0,a||j(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,a){return e=+e,t=t>>>0,a||j(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,a){return e=+e,t=t>>>0,a||j(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,a){return e=+e,t=t>>>0,a||j(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4},l.prototype.writeIntLE=function(e,t,a,c){if(e=+e,t=t>>>0,!c){var p=Math.pow(2,8*a-1);j(this,e,t,a,p-1,-p)}var d=0,T=1,O=0;for(this[t]=e&255;++d<a&&(T*=256);)e<0&&O===0&&this[t+d-1]!==0&&(O=1),this[t+d]=(e/T>>0)-O&255;return t+a},l.prototype.writeIntBE=function(e,t,a,c){if(e=+e,t=t>>>0,!c){var p=Math.pow(2,8*a-1);j(this,e,t,a,p-1,-p)}var d=a-1,T=1,O=0;for(this[t+d]=e&255;--d>=0&&(T*=256);)e<0&&O===0&&this[t+d+1]!==0&&(O=1),this[t+d]=(e/T>>0)-O&255;return t+a},l.prototype.writeInt8=function(e,t,a){return e=+e,t=t>>>0,a||j(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1},l.prototype.writeInt16LE=function(e,t,a){return e=+e,t=t>>>0,a||j(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,a){return e=+e,t=t>>>0,a||j(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2},l.prototype.writeInt32LE=function(e,t,a){return e=+e,t=t>>>0,a||j(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,a){return e=+e,t=t>>>0,a||j(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function Te(s,e,t,a,c,p){if(t+a>s.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function Be(s,e,t,a,c){return e=+e,t=t>>>0,c||Te(s,e,t,4,34028234663852886e22,-34028234663852886e22),i.write(s,e,t,a,23,4),t+4}l.prototype.writeFloatLE=function(e,t,a){return Be(this,e,t,!0,a)},l.prototype.writeFloatBE=function(e,t,a){return Be(this,e,t,!1,a)};function de(s,e,t,a,c){return e=+e,t=t>>>0,c||Te(s,e,t,8,17976931348623157e292,-17976931348623157e292),i.write(s,e,t,a,52,8),t+8}l.prototype.writeDoubleLE=function(e,t,a){return de(this,e,t,!0,a)},l.prototype.writeDoubleBE=function(e,t,a){return de(this,e,t,!1,a)},l.prototype.copy=function(e,t,a,c){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(a||(a=0),!c&&c!==0&&(c=this.length),t>=e.length&&(t=e.length),t||(t=0),c>0&&c<a&&(c=a),c===a||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(a<0||a>=this.length)throw new RangeError("Index out of range");if(c<0)throw new RangeError("sourceEnd out of bounds");c>this.length&&(c=this.length),e.length-t<c-a&&(c=e.length-t+a);var p=c-a;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,a,c):Uint8Array.prototype.set.call(e,this.subarray(a,c),t),p},l.prototype.fill=function(e,t,a,c){if(typeof e=="string"){if(typeof t=="string"?(c=t,t=0,a=this.length):typeof a=="string"&&(c=a,a=this.length),c!==void 0&&typeof c!="string")throw new TypeError("encoding must be a string");if(typeof c=="string"&&!l.isEncoding(c))throw new TypeError("Unknown encoding: "+c);if(e.length===1){var p=e.charCodeAt(0);(c==="utf8"&&p<128||c==="latin1")&&(e=p)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<a)throw new RangeError("Out of range index");if(a<=t)return this;t=t>>>0,a=a===void 0?this.length:a>>>0,e||(e=0);var d;if(typeof e=="number")for(d=t;d<a;++d)this[d]=e;else{var T=l.isBuffer(e)?e:l.from(e,c),O=T.length;if(O===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(d=0;d<a-t;++d)this[d+t]=T[d%O]}return this};var dr=/[^+/0-9A-Za-z-_]/g;function _r(s){if(s=s.split("=")[0],s=s.trim().replace(dr,""),s.length<2)return"";for(;s.length%4!==0;)s=s+"=";return s}function Ze(s,e){e=e||1/0;for(var t,a=s.length,c=null,p=[],d=0;d<a;++d){if(t=s.charCodeAt(d),t>55295&&t<57344){if(!c){if(t>56319){(e-=3)>-1&&p.push(239,191,189);continue}else if(d+1===a){(e-=3)>-1&&p.push(239,191,189);continue}c=t;continue}if(t<56320){(e-=3)>-1&&p.push(239,191,189),c=t;continue}t=(c-55296<<10|t-56320)+65536}else c&&(e-=3)>-1&&p.push(239,191,189);if(c=null,t<128){if((e-=1)<0)break;p.push(t)}else if(t<2048){if((e-=2)<0)break;p.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;p.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;p.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return p}function mr(s){for(var e=[],t=0;t<s.length;++t)e.push(s.charCodeAt(t)&255);return e}function yr(s,e){for(var t,a,c,p=[],d=0;d<s.length&&!((e-=2)<0);++d)t=s.charCodeAt(d),a=t>>8,c=t%256,p.push(c),p.push(a);return p}function dt(s){return r.toByteArray(_r(s))}function Ce(s,e,t,a){for(var c=0;c<a&&!(c+t>=e.length||c>=s.length);++c)e[c+t]=s[c];return c}function z(s,e){return s instanceof e||s!=null&&s.constructor!=null&&s.constructor.name!=null&&s.constructor.name===e.name}function Je(s){return s!==s}var gr=function(){for(var s="0123456789abcdef",e=new Array(256),t=0;t<16;++t)for(var a=t*16,c=0;c<16;++c)e[a+c]=s[t]+s[c];return e}()}(Qe)),Qe}var Sr=Er();const br=vr(Sr);var K={};function Se(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function kr(n){if(n.__esModule)return n;var r=n.default;if(typeof r=="function"){var i=function o(){return this instanceof o?Reflect.construct(r,arguments,this.constructor):r.apply(this,arguments)};i.prototype=r.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(n).forEach(function(o){var f=Object.getOwnPropertyDescriptor(n,o);Object.defineProperty(i,o,f.get?f:{enumerable:!0,get:function(){return n[o]}})}),i}const{Duplex:Tr}=G;function wt(n){n.emit("close")}function Br(){!this.destroyed&&this._writableState.finished&&this.destroy()}function Kt(n){this.removeListener("error",Kt),this.destroy(),this.listenerCount("error")===0&&this.emit("error",n)}function Cr(n,r){let i=!0;const o=new Tr({...r,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return n.on("message",function(u,h){const l=!h&&o._readableState.objectMode?u.toString():u;o.push(l)||n.pause()}),n.once("error",function(u){o.destroyed||(i=!1,o.destroy(u))}),n.once("close",function(){o.destroyed||o.push(null)}),o._destroy=function(f,u){if(n.readyState===n.CLOSED){u(f),process.nextTick(wt,o);return}let h=!1;n.once("error",function(m){h=!0,u(m)}),n.once("close",function(){h||u(f),process.nextTick(wt,o)}),i&&n.terminate()},o._final=function(f){if(n.readyState===n.CONNECTING){n.once("open",function(){o._final(f)});return}n._socket!==null&&(n._socket._writableState.finished?(f(),o._readableState.endEmitted&&o.destroy()):(n._socket.once("finish",function(){f()}),n.close()))},o._read=function(){n.isPaused&&n.resume()},o._write=function(f,u,h){if(n.readyState===n.CONNECTING){n.once("open",function(){o._write(f,u,h)});return}n.send(f,h)},o.on("end",Br),o.on("error",Kt),o}var Or=Cr;const nn=Se(Or);var De={exports:{}},fe={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}},Ue={exports:{}},Le={exports:{}};function Fr(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var et,xt;function Ur(){if(xt)return et;xt=1;var n=G,r=G,i=G,o=typeof __webpack_require__=="function"?__non_webpack_require__:Fr,f=process.config&&process.config.variables||{},u=!!K.PREBUILDS_ONLY,h=process.versions.modules,l=he()?"electron":ne()?"node-webkit":"node",m=K.npm_config_arch||i.arch(),_=K.npm_config_platform||i.platform(),v=K.LIBC||(ze(_)?"musl":"glibc"),y=K.ARM_VERSION||(m==="arm64"?"8":f.arm_version)||"",b=(process.versions.uv||"").split(".")[0];et=g;function g(E){return o(g.resolve(E))}g.resolve=g.path=function(E){E=r.resolve(E||".");try{var B=o(r.join(E,"package.json")).name.toUpperCase().replace(/-/g,"_");K[B+"_PREBUILD"]&&(E=K[B+"_PREBUILD"])}catch{}if(!u){var k=w(r.join(E,"build/Release"),S);if(k)return k;var $=w(r.join(E,"build/Debug"),S);if($)return $}var Z=ke(E);if(Z)return Z;var P=ke(r.dirname(process.execPath));if(P)return P;var Xe=["platform="+_,"arch="+m,"runtime="+l,"abi="+h,"uv="+b,y?"armv="+y:"","libc="+v,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__=="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+Xe+`
    loaded from: `+E+`
`);function ke(pe){var Ke=x(r.join(pe,"prebuilds")).map(F),R=Ke.filter(C(_,m)).sort(L)[0];if(R){var j=r.join(pe,"prebuilds",R.name),Te=x(j).map(D),Be=Te.filter(U(l,h)),de=Be.sort(te(l))[0];if(de)return r.join(j,de.file)}}};function x(E){try{return n.readdirSync(E)}catch{return[]}}function w(E,B){var k=x(E).filter(B);return k[0]&&r.join(E,k[0])}function S(E){return/\.node$/.test(E)}function F(E){var B=E.split("-");if(B.length===2){var k=B[0],$=B[1].split("+");if(k&&$.length&&$.every(Boolean))return{name:E,platform:k,architectures:$}}}function C(E,B){return function(k){return k==null||k.platform!==E?!1:k.architectures.includes(B)}}function L(E,B){return E.architectures.length-B.architectures.length}function D(E){var B=E.split("."),k=B.pop(),$={file:E,specificity:0};if(k==="node"){for(var Z=0;Z<B.length;Z++){var P=B[Z];if(P==="node"||P==="electron"||P==="node-webkit")$.runtime=P;else if(P==="napi")$.napi=!0;else if(P.slice(0,3)==="abi")$.abi=P.slice(3);else if(P.slice(0,2)==="uv")$.uv=P.slice(2);else if(P.slice(0,4)==="armv")$.armv=P.slice(4);else if(P==="glibc"||P==="musl")$.libc=P;else continue;$.specificity++}return $}}function U(E,B){return function(k){return!(k==null||k.runtime!==E&&!ee(k)||k.abi!==B&&!k.napi||k.uv&&k.uv!==b||k.armv&&k.armv!==y||k.libc&&k.libc!==v)}}function ee(E){return E.runtime==="node"&&E.napi}function te(E){return function(B,k){return B.runtime!==k.runtime?B.runtime===E?-1:1:B.abi!==k.abi?B.abi?-1:1:B.specificity!==k.specificity?B.specificity>k.specificity?-1:1:0}}function ne(){return!!(process.versions&&process.versions.nw)}function he(){return process.versions&&process.versions.electron||K.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function ze(E){return E==="linux"&&n.existsSync("/etc/alpine-release")}return g.parseTags=D,g.matchTags=U,g.compareTags=te,g.parseTuple=F,g.matchTuple=C,g.compareTuples=L,et}var Et;function Lr(){return Et||(Et=1,typeof process.addon=="function"?Le.exports=process.addon.bind(process):Le.exports=Ur()),Le.exports}var tt,St;function Nr(){return St||(St=1,tt={mask:(i,o,f,u,h)=>{for(var l=0;l<h;l++)f[u+l]=i[l]^o[l&3]},unmask:(i,o)=>{const f=i.length;for(var u=0;u<f;u++)i[u]^=o[u&3]}}),tt}var bt;function Ar(){if(bt)return Ue.exports;bt=1;try{Ue.exports=Lr()(__dirname)}catch{Ue.exports=Nr()}return Ue.exports}var Ir,Rr;const{EMPTY_BUFFER:Pr}=fe,ut=Buffer[Symbol.species];function Mr(n,r){if(n.length===0)return Pr;if(n.length===1)return n[0];const i=Buffer.allocUnsafe(r);let o=0;for(let f=0;f<n.length;f++){const u=n[f];i.set(u,o),o+=u.length}return o<r?new ut(i.buffer,i.byteOffset,o):i}function Zt(n,r,i,o,f){for(let u=0;u<f;u++)i[o+u]=n[u]^r[u&3]}function Jt(n,r){for(let i=0;i<n.length;i++)n[i]^=r[i&3]}function Dr(n){return n.length===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.length)}function ct(n){if(ct.readOnly=!0,Buffer.isBuffer(n))return n;let r;return n instanceof ArrayBuffer?r=new ut(n):ArrayBuffer.isView(n)?r=new ut(n.buffer,n.byteOffset,n.byteLength):(r=Buffer.from(n),ct.readOnly=!1),r}De.exports={concat:Mr,mask:Zt,toArrayBuffer:Dr,toBuffer:ct,unmask:Jt};if(!K.WS_NO_BUFFER_UTIL)try{const n=Ar();Rr=De.exports.mask=function(r,i,o,f,u){u<48?Zt(r,i,o,f,u):n.mask(r,i,o,f,u)},Ir=De.exports.unmask=function(r,i){r.length<32?Jt(r,i):n.unmask(r,i)}}catch{}var Ge=De.exports;const kt=Symbol("kDone"),rt=Symbol("kRun");let $r=class{constructor(r){this[kt]=()=>{this.pending--,this[rt]()},this.concurrency=r||1/0,this.jobs=[],this.pending=0}add(r){this.jobs.push(r),this[rt]()}[rt](){if(this.pending!==this.concurrency&&this.jobs.length){const r=this.jobs.shift();this.pending++,r(this[kt])}}};var Wr=$r;const me=G,Tt=Ge,jr=Wr,{kStatusCode:Qt}=fe,Gr=Buffer[Symbol.species],Vr=Buffer.from([0,0,255,255]),$e=Symbol("permessage-deflate"),J=Symbol("total-length"),xe=Symbol("callback"),re=Symbol("buffers"),Pe=Symbol("error");let Ne,qr=class{constructor(r,i,o){if(this._maxPayload=o|0,this._options=r||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!i,this._deflate=null,this._inflate=null,this.params=null,!Ne){const f=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Ne=new jr(f)}}static get extensionName(){return"permessage-deflate"}offer(){const r={};return this._options.serverNoContextTakeover&&(r.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(r.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(r.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?r.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(r.client_max_window_bits=!0),r}accept(r){return r=this.normalizeParams(r),this.params=this._isServer?this.acceptAsServer(r):this.acceptAsClient(r),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const r=this._deflate[xe];this._deflate.close(),this._deflate=null,r&&r(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(r){const i=this._options,o=r.find(f=>!(i.serverNoContextTakeover===!1&&f.server_no_context_takeover||f.server_max_window_bits&&(i.serverMaxWindowBits===!1||typeof i.serverMaxWindowBits=="number"&&i.serverMaxWindowBits>f.server_max_window_bits)||typeof i.clientMaxWindowBits=="number"&&!f.client_max_window_bits));if(!o)throw new Error("None of the extension offers can be accepted");return i.serverNoContextTakeover&&(o.server_no_context_takeover=!0),i.clientNoContextTakeover&&(o.client_no_context_takeover=!0),typeof i.serverMaxWindowBits=="number"&&(o.server_max_window_bits=i.serverMaxWindowBits),typeof i.clientMaxWindowBits=="number"?o.client_max_window_bits=i.clientMaxWindowBits:(o.client_max_window_bits===!0||i.clientMaxWindowBits===!1)&&delete o.client_max_window_bits,o}acceptAsClient(r){const i=r[0];if(this._options.clientNoContextTakeover===!1&&i.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!i.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(i.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&i.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return i}normalizeParams(r){return r.forEach(i=>{Object.keys(i).forEach(o=>{let f=i[o];if(f.length>1)throw new Error(`Parameter "${o}" must have only a single value`);if(f=f[0],o==="client_max_window_bits"){if(f!==!0){const u=+f;if(!Number.isInteger(u)||u<8||u>15)throw new TypeError(`Invalid value for parameter "${o}": ${f}`);f=u}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${o}": ${f}`)}else if(o==="server_max_window_bits"){const u=+f;if(!Number.isInteger(u)||u<8||u>15)throw new TypeError(`Invalid value for parameter "${o}": ${f}`);f=u}else if(o==="client_no_context_takeover"||o==="server_no_context_takeover"){if(f!==!0)throw new TypeError(`Invalid value for parameter "${o}": ${f}`)}else throw new Error(`Unknown parameter "${o}"`);i[o]=f})}),r}decompress(r,i,o){Ne.add(f=>{this._decompress(r,i,(u,h)=>{f(),o(u,h)})})}compress(r,i,o){Ne.add(f=>{this._compress(r,i,(u,h)=>{f(),o(u,h)})})}_decompress(r,i,o){const f=this._isServer?"client":"server";if(!this._inflate){const u=`${f}_max_window_bits`,h=typeof this.params[u]!="number"?me.Z_DEFAULT_WINDOWBITS:this.params[u];this._inflate=me.createInflateRaw({...this._options.zlibInflateOptions,windowBits:h}),this._inflate[$e]=this,this._inflate[J]=0,this._inflate[re]=[],this._inflate.on("error",Yr),this._inflate.on("data",er)}this._inflate[xe]=o,this._inflate.write(r),i&&this._inflate.write(Vr),this._inflate.flush(()=>{const u=this._inflate[Pe];if(u){this._inflate.close(),this._inflate=null,o(u);return}const h=Tt.concat(this._inflate[re],this._inflate[J]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[J]=0,this._inflate[re]=[],i&&this.params[`${f}_no_context_takeover`]&&this._inflate.reset()),o(null,h)})}_compress(r,i,o){const f=this._isServer?"server":"client";if(!this._deflate){const u=`${f}_max_window_bits`,h=typeof this.params[u]!="number"?me.Z_DEFAULT_WINDOWBITS:this.params[u];this._deflate=me.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:h}),this._deflate[J]=0,this._deflate[re]=[],this._deflate.on("data",Hr)}this._deflate[xe]=o,this._deflate.write(r),this._deflate.flush(me.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let u=Tt.concat(this._deflate[re],this._deflate[J]);i&&(u=new Gr(u.buffer,u.byteOffset,u.length-4)),this._deflate[xe]=null,this._deflate[J]=0,this._deflate[re]=[],i&&this.params[`${f}_no_context_takeover`]&&this._deflate.reset(),o(null,u)})}};var Ve=qr;function Hr(n){this[re].push(n),this[J]+=n.length}function er(n){if(this[J]+=n.length,this[$e]._maxPayload<1||this[J]<=this[$e]._maxPayload){this[re].push(n);return}this[Pe]=new RangeError("Max payload size exceeded"),this[Pe].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Pe][Qt]=1009,this.removeListener("data",er),this.reset()}function Yr(n){this[$e]._inflate=null,n[Qt]=1007,this[xe](n)}var We={exports:{}};const zr={},Xr=Object.freeze(Object.defineProperty({__proto__:null,default:zr},Symbol.toStringTag,{value:"Module"})),Kr=kr(Xr);var Bt;const{isUtf8:Ct}=br,Zr=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Jr(n){return n>=1e3&&n<=1014&&n!==1004&&n!==1005&&n!==1006||n>=3e3&&n<=4999}function ht(n){const r=n.length;let i=0;for(;i<r;)if(!(n[i]&128))i++;else if((n[i]&224)===192){if(i+1===r||(n[i+1]&192)!==128||(n[i]&254)===192)return!1;i+=2}else if((n[i]&240)===224){if(i+2>=r||(n[i+1]&192)!==128||(n[i+2]&192)!==128||n[i]===224&&(n[i+1]&224)===128||n[i]===237&&(n[i+1]&224)===160)return!1;i+=3}else if((n[i]&248)===240){if(i+3>=r||(n[i+1]&192)!==128||(n[i+2]&192)!==128||(n[i+3]&192)!==128||n[i]===240&&(n[i+1]&240)===128||n[i]===244&&n[i+1]>143||n[i]>244)return!1;i+=4}else return!1;return!0}We.exports={isValidStatusCode:Jr,isValidUTF8:ht,tokenChars:Zr};if(Ct)Bt=We.exports.isValidUTF8=function(n){return n.length<24?ht(n):Ct(n)};else if(!K.WS_NO_UTF_8_VALIDATE)try{const n=Kr;Bt=We.exports.isValidUTF8=function(r){return r.length<32?ht(r):n(r)}}catch{}var qe=We.exports;const{Writable:Qr}=G,Ot=Ve,{BINARY_TYPES:ei,EMPTY_BUFFER:Ft,kStatusCode:ti,kWebSocket:ri}=fe,{concat:it,toArrayBuffer:ii,unmask:ni}=Ge,{isValidStatusCode:si,isValidUTF8:Ut}=qe,Ae=Buffer[Symbol.species],ye=0,Lt=1,Nt=2,At=3,nt=4,oi=5;let ai=class extends Qr{constructor(r={}){super(),this._binaryType=r.binaryType||ei[0],this._extensions=r.extensions||{},this._isServer=!!r.isServer,this._maxPayload=r.maxPayload|0,this._skipUTF8Validation=!!r.skipUTF8Validation,this[ri]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=ye,this._loop=!1}_write(r,i,o){if(this._opcode===8&&this._state==ye)return o();this._bufferedBytes+=r.length,this._buffers.push(r),this.startLoop(o)}consume(r){if(this._bufferedBytes-=r,r===this._buffers[0].length)return this._buffers.shift();if(r<this._buffers[0].length){const o=this._buffers[0];return this._buffers[0]=new Ae(o.buffer,o.byteOffset+r,o.length-r),new Ae(o.buffer,o.byteOffset,r)}const i=Buffer.allocUnsafe(r);do{const o=this._buffers[0],f=i.length-r;r>=o.length?i.set(this._buffers.shift(),f):(i.set(new Uint8Array(o.buffer,o.byteOffset,r),f),this._buffers[0]=new Ae(o.buffer,o.byteOffset+r,o.length-r)),r-=o.length}while(r>0);return i}startLoop(r){let i;this._loop=!0;do switch(this._state){case ye:i=this.getInfo();break;case Lt:i=this.getPayloadLength16();break;case Nt:i=this.getPayloadLength64();break;case At:this.getMask();break;case nt:i=this.getData(r);break;default:this._loop=!1;return}while(this._loop);r(i)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}const r=this.consume(2);if(r[0]&48)return this._loop=!1,W(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");const i=(r[0]&64)===64;if(i&&!this._extensions[Ot.extensionName])return this._loop=!1,W(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(r[0]&128)===128,this._opcode=r[0]&15,this._payloadLength=r[1]&127,this._opcode===0){if(i)return this._loop=!1,W(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,W(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,W(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=i}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,W(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(i)return this._loop=!1,W(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1)return this._loop=!1,W(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}else return this._loop=!1,W(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(r[1]&128)===128,this._isServer){if(!this._masked)return this._loop=!1,W(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,W(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(this._payloadLength===126)this._state=Lt;else if(this._payloadLength===127)this._state=Nt;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}const r=this.consume(8),i=r.readUInt32BE(0);return i>Math.pow(2,21)-1?(this._loop=!1,W(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=i*Math.pow(2,32)+r.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,W(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=At:this._state=nt}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=nt}getData(r){let i=Ft;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}i=this.consume(this._payloadLength),this._masked&&this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3]&&ni(i,this._mask)}if(this._opcode>7)return this.controlMessage(i);if(this._compressed){this._state=oi,this.decompress(i,r);return}return i.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(i)),this.dataMessage()}decompress(r,i){this._extensions[Ot.extensionName].decompress(r,this._fin,(f,u)=>{if(f)return i(f);if(u.length){if(this._messageLength+=u.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return i(W(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(u)}const h=this.dataMessage();if(h)return i(h);this.startLoop(i)})}dataMessage(){if(this._fin){const r=this._messageLength,i=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let o;this._binaryType==="nodebuffer"?o=it(i,r):this._binaryType==="arraybuffer"?o=ii(it(i,r)):o=i,this.emit("message",o,!0)}else{const o=it(i,r);if(!this._skipUTF8Validation&&!Ut(o))return this._loop=!1,W(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",o,!1)}}this._state=ye}controlMessage(r){if(this._opcode===8)if(this._loop=!1,r.length===0)this.emit("conclude",1005,Ft),this.end();else{const i=r.readUInt16BE(0);if(!si(i))return W(RangeError,`invalid status code ${i}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");const o=new Ae(r.buffer,r.byteOffset+2,r.length-2);if(!this._skipUTF8Validation&&!Ut(o))return W(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",i,o),this.end()}else this._opcode===9?this.emit("ping",r):this.emit("pong",r);this._state=ye}};var tr=ai;function W(n,r,i,o,f){const u=new n(i?`Invalid WebSocket frame: ${r}`:r);return Error.captureStackTrace(u,W),u.code=f,u[ti]=o,u}const fn=Se(tr),{randomFillSync:fi}=G,It=Ve,{EMPTY_BUFFER:li}=fe,{isValidStatusCode:ui}=qe,{mask:Rt,toBuffer:ue}=Ge,Y=Symbol("kByteLength"),ci=Buffer.alloc(4);let hi=class oe{constructor(r,i,o){this._extensions=i||{},o&&(this._generateMask=o,this._maskBuffer=Buffer.alloc(4)),this._socket=r,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(r,i){let o,f=!1,u=2,h=!1;i.mask&&(o=i.maskBuffer||ci,i.generateMask?i.generateMask(o):fi(o,0,4),h=(o[0]|o[1]|o[2]|o[3])===0,u=6);let l;typeof r=="string"?(!i.mask||h)&&i[Y]!==void 0?l=i[Y]:(r=Buffer.from(r),l=r.length):(l=r.length,f=i.mask&&i.readOnly&&!h);let m=l;l>=65536?(u+=8,m=127):l>125&&(u+=2,m=126);const _=Buffer.allocUnsafe(f?l+u:u);return _[0]=i.fin?i.opcode|128:i.opcode,i.rsv1&&(_[0]|=64),_[1]=m,m===126?_.writeUInt16BE(l,2):m===127&&(_[2]=_[3]=0,_.writeUIntBE(l,4,6)),i.mask?(_[1]|=128,_[u-4]=o[0],_[u-3]=o[1],_[u-2]=o[2],_[u-1]=o[3],h?[_,r]:f?(Rt(r,o,_,u,l),[_]):(Rt(r,o,r,0,l),[_,r])):[_,r]}close(r,i,o,f){let u;if(r===void 0)u=li;else{if(typeof r!="number"||!ui(r))throw new TypeError("First argument must be a valid error code number");if(i===void 0||!i.length)u=Buffer.allocUnsafe(2),u.writeUInt16BE(r,0);else{const l=Buffer.byteLength(i);if(l>123)throw new RangeError("The message must not be greater than 123 bytes");u=Buffer.allocUnsafe(2+l),u.writeUInt16BE(r,0),typeof i=="string"?u.write(i,2):u.set(i,2)}}const h={[Y]:u.length,fin:!0,generateMask:this._generateMask,mask:o,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,u,!1,h,f]):this.sendFrame(oe.frame(u,h),f)}ping(r,i,o){let f,u;if(typeof r=="string"?(f=Buffer.byteLength(r),u=!1):(r=ue(r),f=r.length,u=ue.readOnly),f>125)throw new RangeError("The data size must not be greater than 125 bytes");const h={[Y]:f,fin:!0,generateMask:this._generateMask,mask:i,maskBuffer:this._maskBuffer,opcode:9,readOnly:u,rsv1:!1};this._deflating?this.enqueue([this.dispatch,r,!1,h,o]):this.sendFrame(oe.frame(r,h),o)}pong(r,i,o){let f,u;if(typeof r=="string"?(f=Buffer.byteLength(r),u=!1):(r=ue(r),f=r.length,u=ue.readOnly),f>125)throw new RangeError("The data size must not be greater than 125 bytes");const h={[Y]:f,fin:!0,generateMask:this._generateMask,mask:i,maskBuffer:this._maskBuffer,opcode:10,readOnly:u,rsv1:!1};this._deflating?this.enqueue([this.dispatch,r,!1,h,o]):this.sendFrame(oe.frame(r,h),o)}send(r,i,o){const f=this._extensions[It.extensionName];let u=i.binary?2:1,h=i.compress,l,m;if(typeof r=="string"?(l=Buffer.byteLength(r),m=!1):(r=ue(r),l=r.length,m=ue.readOnly),this._firstFragment?(this._firstFragment=!1,h&&f&&f.params[f._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(h=l>=f._threshold),this._compress=h):(h=!1,u=0),i.fin&&(this._firstFragment=!0),f){const _={[Y]:l,fin:i.fin,generateMask:this._generateMask,mask:i.mask,maskBuffer:this._maskBuffer,opcode:u,readOnly:m,rsv1:h};this._deflating?this.enqueue([this.dispatch,r,this._compress,_,o]):this.dispatch(r,this._compress,_,o)}else this.sendFrame(oe.frame(r,{[Y]:l,fin:i.fin,generateMask:this._generateMask,mask:i.mask,maskBuffer:this._maskBuffer,opcode:u,readOnly:m,rsv1:!1}),o)}dispatch(r,i,o,f){if(!i){this.sendFrame(oe.frame(r,o),f);return}const u=this._extensions[It.extensionName];this._bufferedBytes+=o[Y],this._deflating=!0,u.compress(r,o.fin,(h,l)=>{if(this._socket.destroyed){const m=new Error("The socket was closed while data was being compressed");typeof f=="function"&&f(m);for(let _=0;_<this._queue.length;_++){const v=this._queue[_],y=v[v.length-1];typeof y=="function"&&y(m)}return}this._bufferedBytes-=o[Y],this._deflating=!1,o.readOnly=!1,this.sendFrame(oe.frame(l,o),f),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){const r=this._queue.shift();this._bufferedBytes-=r[3][Y],Reflect.apply(r[0],this,r.slice(1))}}enqueue(r){this._bufferedBytes+=r[3][Y],this._queue.push(r)}sendFrame(r,i){r.length===2?(this._socket.cork(),this._socket.write(r[0]),this._socket.write(r[1],i),this._socket.uncork()):this._socket.write(r[0],i)}};var rr=hi;const ln=Se(rr),{kForOnEventAttribute:ge,kListener:st}=fe,Pt=Symbol("kCode"),Mt=Symbol("kData"),Dt=Symbol("kError"),$t=Symbol("kMessage"),Wt=Symbol("kReason"),ce=Symbol("kTarget"),jt=Symbol("kType"),Gt=Symbol("kWasClean");class le{constructor(r){this[ce]=null,this[jt]=r}get target(){return this[ce]}get type(){return this[jt]}}Object.defineProperty(le.prototype,"target",{enumerable:!0});Object.defineProperty(le.prototype,"type",{enumerable:!0});class be extends le{constructor(r,i={}){super(r),this[Pt]=i.code===void 0?0:i.code,this[Wt]=i.reason===void 0?"":i.reason,this[Gt]=i.wasClean===void 0?!1:i.wasClean}get code(){return this[Pt]}get reason(){return this[Wt]}get wasClean(){return this[Gt]}}Object.defineProperty(be.prototype,"code",{enumerable:!0});Object.defineProperty(be.prototype,"reason",{enumerable:!0});Object.defineProperty(be.prototype,"wasClean",{enumerable:!0});class He extends le{constructor(r,i={}){super(r),this[Dt]=i.error===void 0?null:i.error,this[$t]=i.message===void 0?"":i.message}get error(){return this[Dt]}get message(){return this[$t]}}Object.defineProperty(He.prototype,"error",{enumerable:!0});Object.defineProperty(He.prototype,"message",{enumerable:!0});class pt extends le{constructor(r,i={}){super(r),this[Mt]=i.data===void 0?null:i.data}get data(){return this[Mt]}}Object.defineProperty(pt.prototype,"data",{enumerable:!0});const pi={addEventListener(n,r,i={}){for(const f of this.listeners(n))if(!i[ge]&&f[st]===r&&!f[ge])return;let o;if(n==="message")o=function(u,h){const l=new pt("message",{data:h?u:u.toString()});l[ce]=this,Ie(r,this,l)};else if(n==="close")o=function(u,h){const l=new be("close",{code:u,reason:h.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});l[ce]=this,Ie(r,this,l)};else if(n==="error")o=function(u){const h=new He("error",{error:u,message:u.message});h[ce]=this,Ie(r,this,h)};else if(n==="open")o=function(){const u=new le("open");u[ce]=this,Ie(r,this,u)};else return;o[ge]=!!i[ge],o[st]=r,i.once?this.once(n,o):this.on(n,o)},removeEventListener(n,r){for(const i of this.listeners(n))if(i[st]===r&&!i[ge]){this.removeListener(n,i);break}}};var di={CloseEvent:be,ErrorEvent:He,Event:le,EventTarget:pi,MessageEvent:pt};function Ie(n,r,i){typeof n=="object"&&n.handleEvent?n.handleEvent.call(n,i):n.call(r,i)}const{tokenChars:ve}=qe;function X(n,r,i){n[r]===void 0?n[r]=[i]:n[r].push(i)}function _i(n){const r=Object.create(null);let i=Object.create(null),o=!1,f=!1,u=!1,h,l,m=-1,_=-1,v=-1,y=0;for(;y<n.length;y++)if(_=n.charCodeAt(y),h===void 0)if(v===-1&&ve[_]===1)m===-1&&(m=y);else if(y!==0&&(_===32||_===9))v===-1&&m!==-1&&(v=y);else if(_===59||_===44){if(m===-1)throw new SyntaxError(`Unexpected character at index ${y}`);v===-1&&(v=y);const g=n.slice(m,v);_===44?(X(r,g,i),i=Object.create(null)):h=g,m=v=-1}else throw new SyntaxError(`Unexpected character at index ${y}`);else if(l===void 0)if(v===-1&&ve[_]===1)m===-1&&(m=y);else if(_===32||_===9)v===-1&&m!==-1&&(v=y);else if(_===59||_===44){if(m===-1)throw new SyntaxError(`Unexpected character at index ${y}`);v===-1&&(v=y),X(i,n.slice(m,v),!0),_===44&&(X(r,h,i),i=Object.create(null),h=void 0),m=v=-1}else if(_===61&&m!==-1&&v===-1)l=n.slice(m,y),m=v=-1;else throw new SyntaxError(`Unexpected character at index ${y}`);else if(f){if(ve[_]!==1)throw new SyntaxError(`Unexpected character at index ${y}`);m===-1?m=y:o||(o=!0),f=!1}else if(u)if(ve[_]===1)m===-1&&(m=y);else if(_===34&&m!==-1)u=!1,v=y;else if(_===92)f=!0;else throw new SyntaxError(`Unexpected character at index ${y}`);else if(_===34&&n.charCodeAt(y-1)===61)u=!0;else if(v===-1&&ve[_]===1)m===-1&&(m=y);else if(m!==-1&&(_===32||_===9))v===-1&&(v=y);else if(_===59||_===44){if(m===-1)throw new SyntaxError(`Unexpected character at index ${y}`);v===-1&&(v=y);let g=n.slice(m,v);o&&(g=g.replace(/\\/g,""),o=!1),X(i,l,g),_===44&&(X(r,h,i),i=Object.create(null),h=void 0),l=void 0,m=v=-1}else throw new SyntaxError(`Unexpected character at index ${y}`);if(m===-1||u||_===32||_===9)throw new SyntaxError("Unexpected end of input");v===-1&&(v=y);const b=n.slice(m,v);return h===void 0?X(r,b,i):(l===void 0?X(i,b,!0):o?X(i,l,b.replace(/\\/g,"")):X(i,l,b),X(r,h,i)),r}function mi(n){return Object.keys(n).map(r=>{let i=n[r];return Array.isArray(i)||(i=[i]),i.map(o=>[r].concat(Object.keys(o).map(f=>{let u=o[f];return Array.isArray(u)||(u=[u]),u.map(h=>h===!0?f:`${f}=${h}`).join("; ")})).join("; ")).join(", ")}).join(", ")}var ir={format:mi,parse:_i};const yi=G,gi=G,vi=G,nr=G,wi=G,{randomBytes:xi,createHash:Ei}=G,{URL:ot}=G,ie=Ve,Si=tr,bi=rr,{BINARY_TYPES:Vt,EMPTY_BUFFER:Re,GUID:ki,kForOnEventAttribute:at,kListener:Ti,kStatusCode:Bi,kWebSocket:q,NOOP:sr}=fe,{EventTarget:{addEventListener:Ci,removeEventListener:Oi}}=di,{format:Fi,parse:Ui}=ir,{toBuffer:Li}=Ge,Ni=30*1e3,or=Symbol("kAborted"),ft=[8,13],Q=["CONNECTING","OPEN","CLOSING","CLOSED"],Ai=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;let M=class I extends yi{constructor(r,i,o){super(),this._binaryType=Vt[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Re,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=I.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,r!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,i===void 0?i=[]:Array.isArray(i)||(typeof i=="object"&&i!==null?(o=i,i=[]):i=[i]),fr(this,r,i,o)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(r){Vt.includes(r)&&(this._binaryType=r,this._receiver&&(this._receiver._binaryType=r))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(r,i,o){const f=new Si({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:o.maxPayload,skipUTF8Validation:o.skipUTF8Validation});this._sender=new bi(r,this._extensions,o.generateMask),this._receiver=f,this._socket=r,f[q]=this,r[q]=this,f.on("conclude",Pi),f.on("drain",Mi),f.on("error",Di),f.on("message",$i),f.on("ping",Wi),f.on("pong",ji),r.setTimeout(0),r.setNoDelay(),i.length>0&&r.unshift(i),r.on("close",ur),r.on("data",Ye),r.on("end",cr),r.on("error",hr),this._readyState=I.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=I.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[ie.extensionName]&&this._extensions[ie.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=I.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(r,i){if(this.readyState!==I.CLOSED){if(this.readyState===I.CONNECTING){H(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===I.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=I.CLOSING,this._sender.close(r,i,!this._isServer,o=>{o||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),Ni)}}pause(){this.readyState===I.CONNECTING||this.readyState===I.CLOSED||(this._paused=!0,this._socket.pause())}ping(r,i,o){if(this.readyState===I.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"?(o=r,r=i=void 0):typeof i=="function"&&(o=i,i=void 0),typeof r=="number"&&(r=r.toString()),this.readyState!==I.OPEN){lt(this,r,o);return}i===void 0&&(i=!this._isServer),this._sender.ping(r||Re,i,o)}pong(r,i,o){if(this.readyState===I.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"?(o=r,r=i=void 0):typeof i=="function"&&(o=i,i=void 0),typeof r=="number"&&(r=r.toString()),this.readyState!==I.OPEN){lt(this,r,o);return}i===void 0&&(i=!this._isServer),this._sender.pong(r||Re,i,o)}resume(){this.readyState===I.CONNECTING||this.readyState===I.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(r,i,o){if(this.readyState===I.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof i=="function"&&(o=i,i={}),typeof r=="number"&&(r=r.toString()),this.readyState!==I.OPEN){lt(this,r,o);return}const f={binary:typeof r!="string",mask:!this._isServer,compress:!0,fin:!0,...i};this._extensions[ie.extensionName]||(f.compress=!1),this._sender.send(r||Re,f,o)}terminate(){if(this.readyState!==I.CLOSED){if(this.readyState===I.CONNECTING){H(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=I.CLOSING,this._socket.destroy())}}};Object.defineProperty(M,"CONNECTING",{enumerable:!0,value:Q.indexOf("CONNECTING")});Object.defineProperty(M.prototype,"CONNECTING",{enumerable:!0,value:Q.indexOf("CONNECTING")});Object.defineProperty(M,"OPEN",{enumerable:!0,value:Q.indexOf("OPEN")});Object.defineProperty(M.prototype,"OPEN",{enumerable:!0,value:Q.indexOf("OPEN")});Object.defineProperty(M,"CLOSING",{enumerable:!0,value:Q.indexOf("CLOSING")});Object.defineProperty(M.prototype,"CLOSING",{enumerable:!0,value:Q.indexOf("CLOSING")});Object.defineProperty(M,"CLOSED",{enumerable:!0,value:Q.indexOf("CLOSED")});Object.defineProperty(M.prototype,"CLOSED",{enumerable:!0,value:Q.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(n=>{Object.defineProperty(M.prototype,n,{enumerable:!0})});["open","error","close","message"].forEach(n=>{Object.defineProperty(M.prototype,`on${n}`,{enumerable:!0,get(){for(const r of this.listeners(n))if(r[at])return r[Ti];return null},set(r){for(const i of this.listeners(n))if(i[at]){this.removeListener(n,i);break}typeof r=="function"&&this.addEventListener(n,r,{[at]:!0})}})});M.prototype.addEventListener=Ci;M.prototype.removeEventListener=Oi;var ar=M;function fr(n,r,i,o){const f={protocolVersion:ft[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...o,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(!ft.includes(f.protocolVersion))throw new RangeError(`Unsupported protocol version: ${f.protocolVersion} (supported versions: ${ft.join(", ")})`);let u;if(r instanceof ot)u=r,n._url=r.href;else{try{u=new ot(r)}catch{throw new SyntaxError(`Invalid URL: ${r}`)}n._url=r}const h=u.protocol==="wss:",l=u.protocol==="ws+unix:";let m;if(u.protocol!=="ws:"&&!h&&!l?m=`The URL's protocol must be one of "ws:", "wss:", or "ws+unix:"`:l&&!u.pathname?m="The URL's pathname is empty":u.hash&&(m="The URL contains a fragment identifier"),m){const w=new SyntaxError(m);if(n._redirects===0)throw w;Me(n,w);return}const _=h?443:80,v=xi(16).toString("base64"),y=h?gi.request:vi.request,b=new Set;let g;if(f.createConnection=h?Ri:Ii,f.defaultPort=f.defaultPort||_,f.port=u.port||_,f.host=u.hostname.startsWith("[")?u.hostname.slice(1,-1):u.hostname,f.headers={...f.headers,"Sec-WebSocket-Version":f.protocolVersion,"Sec-WebSocket-Key":v,Connection:"Upgrade",Upgrade:"websocket"},f.path=u.pathname+u.search,f.timeout=f.handshakeTimeout,f.perMessageDeflate&&(g=new ie(f.perMessageDeflate!==!0?f.perMessageDeflate:{},!1,f.maxPayload),f.headers["Sec-WebSocket-Extensions"]=Fi({[ie.extensionName]:g.offer()})),i.length){for(const w of i){if(typeof w!="string"||!Ai.test(w)||b.has(w))throw new SyntaxError("An invalid or duplicated subprotocol was specified");b.add(w)}f.headers["Sec-WebSocket-Protocol"]=i.join(",")}if(f.origin&&(f.protocolVersion<13?f.headers["Sec-WebSocket-Origin"]=f.origin:f.headers.Origin=f.origin),(u.username||u.password)&&(f.auth=`${u.username}:${u.password}`),l){const w=f.path.split(":");f.socketPath=w[0],f.path=w[1]}let x;if(f.followRedirects){if(n._redirects===0){n._originalIpc=l,n._originalSecure=h,n._originalHostOrSocketPath=l?f.socketPath:u.host;const w=o&&o.headers;if(o={...o,headers:{}},w)for(const[S,F]of Object.entries(w))o.headers[S.toLowerCase()]=F}else if(n.listenerCount("redirect")===0){const w=l?n._originalIpc?f.socketPath===n._originalHostOrSocketPath:!1:n._originalIpc?!1:u.host===n._originalHostOrSocketPath;(!w||n._originalSecure&&!h)&&(delete f.headers.authorization,delete f.headers.cookie,w||delete f.headers.host,f.auth=void 0)}f.auth&&!o.headers.authorization&&(o.headers.authorization="Basic "+Buffer.from(f.auth).toString("base64")),x=n._req=y(f),n._redirects&&n.emit("redirect",n.url,x)}else x=n._req=y(f);f.timeout&&x.on("timeout",()=>{H(n,x,"Opening handshake has timed out")}),x.on("error",w=>{x===null||x[or]||(x=n._req=null,Me(n,w))}),x.on("response",w=>{const S=w.headers.location,F=w.statusCode;if(S&&f.followRedirects&&F>=300&&F<400){if(++n._redirects>f.maxRedirects){H(n,x,"Maximum redirects exceeded");return}x.abort();let C;try{C=new ot(S,r)}catch{const D=new SyntaxError(`Invalid URL: ${S}`);Me(n,D);return}fr(n,C,i,o)}else n.emit("unexpected-response",x,w)||H(n,x,`Unexpected server response: ${w.statusCode}`)}),x.on("upgrade",(w,S,F)=>{if(n.emit("upgrade",w),n.readyState!==M.CONNECTING)return;if(x=n._req=null,w.headers.upgrade.toLowerCase()!=="websocket"){H(n,S,"Invalid Upgrade header");return}const C=Ei("sha1").update(v+ki).digest("base64");if(w.headers["sec-websocket-accept"]!==C){H(n,S,"Invalid Sec-WebSocket-Accept header");return}const L=w.headers["sec-websocket-protocol"];let D;if(L!==void 0?b.size?b.has(L)||(D="Server sent an invalid subprotocol"):D="Server sent a subprotocol but none was requested":b.size&&(D="Server sent no subprotocol"),D){H(n,S,D);return}L&&(n._protocol=L);const U=w.headers["sec-websocket-extensions"];if(U!==void 0){if(!g){H(n,S,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let ee;try{ee=Ui(U)}catch{H(n,S,"Invalid Sec-WebSocket-Extensions header");return}const te=Object.keys(ee);if(te.length!==1||te[0]!==ie.extensionName){H(n,S,"Server indicated an extension that was not requested");return}try{g.accept(ee[ie.extensionName])}catch{H(n,S,"Invalid Sec-WebSocket-Extensions header");return}n._extensions[ie.extensionName]=g}n.setSocket(S,F,{generateMask:f.generateMask,maxPayload:f.maxPayload,skipUTF8Validation:f.skipUTF8Validation})}),f.finishRequest?f.finishRequest(x,n):x.end()}function Me(n,r){n._readyState=M.CLOSING,n.emit("error",r),n.emitClose()}function Ii(n){return n.path=n.socketPath,nr.connect(n)}function Ri(n){return n.path=void 0,!n.servername&&n.servername!==""&&(n.servername=nr.isIP(n.host)?"":n.host),wi.connect(n)}function H(n,r,i){n._readyState=M.CLOSING;const o=new Error(i);Error.captureStackTrace(o,H),r.setHeader?(r[or]=!0,r.abort(),r.socket&&!r.socket.destroyed&&r.socket.destroy(),process.nextTick(Me,n,o)):(r.destroy(o),r.once("error",n.emit.bind(n,"error")),r.once("close",n.emitClose.bind(n)))}function lt(n,r,i){if(r){const o=Li(r).length;n._socket?n._sender._bufferedBytes+=o:n._bufferedAmount+=o}if(i){const o=new Error(`WebSocket is not open: readyState ${n.readyState} (${Q[n.readyState]})`);process.nextTick(i,o)}}function Pi(n,r){const i=this[q];i._closeFrameReceived=!0,i._closeMessage=r,i._closeCode=n,i._socket[q]!==void 0&&(i._socket.removeListener("data",Ye),process.nextTick(lr,i._socket),n===1005?i.close():i.close(n,r))}function Mi(){const n=this[q];n.isPaused||n._socket.resume()}function Di(n){const r=this[q];r._socket[q]!==void 0&&(r._socket.removeListener("data",Ye),process.nextTick(lr,r._socket),r.close(n[Bi])),r.emit("error",n)}function qt(){this[q].emitClose()}function $i(n,r){this[q].emit("message",n,r)}function Wi(n){const r=this[q];r.pong(n,!r._isServer,sr),r.emit("ping",n)}function ji(n){this[q].emit("pong",n)}function lr(n){n.resume()}function ur(){const n=this[q];this.removeListener("close",ur),this.removeListener("data",Ye),this.removeListener("end",cr),n._readyState=M.CLOSING;let r;!this._readableState.endEmitted&&!n._closeFrameReceived&&!n._receiver._writableState.errorEmitted&&(r=n._socket.read())!==null&&n._receiver.write(r),n._receiver.end(),this[q]=void 0,clearTimeout(n._closeTimer),n._receiver._writableState.finished||n._receiver._writableState.errorEmitted?n.emitClose():(n._receiver.on("error",qt),n._receiver.on("finish",qt))}function Ye(n){this[q]._receiver.write(n)||this.pause()}function cr(){const n=this[q];n._readyState=M.CLOSING,n._receiver.end(),this.end()}function hr(){const n=this[q];this.removeListener("error",hr),this.on("error",sr),n&&(n._readyState=M.CLOSING,this.destroy())}const un=Se(ar),{tokenChars:Gi}=qe;function Vi(n){const r=new Set;let i=-1,o=-1,f=0;for(f;f<n.length;f++){const h=n.charCodeAt(f);if(o===-1&&Gi[h]===1)i===-1&&(i=f);else if(f!==0&&(h===32||h===9))o===-1&&i!==-1&&(o=f);else if(h===44){if(i===-1)throw new SyntaxError(`Unexpected character at index ${f}`);o===-1&&(o=f);const l=n.slice(i,o);if(r.has(l))throw new SyntaxError(`The "${l}" subprotocol is duplicated`);r.add(l),i=o=-1}else throw new SyntaxError(`Unexpected character at index ${f}`)}if(i===-1||o!==-1)throw new SyntaxError("Unexpected end of input");const u=n.slice(i,f);if(r.has(u))throw new SyntaxError(`The "${u}" subprotocol is duplicated`);return r.add(u),r}var qi={parse:Vi};const Hi=G,je=G,{createHash:Yi}=G,Ht=ir,se=Ve,zi=qi,Xi=ar,{GUID:Ki,kWebSocket:Zi}=fe,Ji=/^[+/0-9A-Za-z]{22}==$/,Yt=0,zt=1,pr=2;class Qi extends Hi{constructor(r,i){if(super(),r={maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:Xi,...r},r.port==null&&!r.server&&!r.noServer||r.port!=null&&(r.server||r.noServer)||r.server&&r.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(r.port!=null?(this._server=je.createServer((o,f)=>{const u=je.STATUS_CODES[426];f.writeHead(426,{"Content-Length":u.length,"Content-Type":"text/plain"}),f.end(u)}),this._server.listen(r.port,r.host,r.backlog,i)):r.server&&(this._server=r.server),this._server){const o=this.emit.bind(this,"connection");this._removeListeners=tn(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(f,u,h)=>{this.handleUpgrade(f,u,h,o)}})}r.perMessageDeflate===!0&&(r.perMessageDeflate={}),r.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=r,this._state=Yt}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(r){if(this._state===pr){r&&this.once("close",()=>{r(new Error("The server is not running"))}),process.nextTick(we,this);return}if(r&&this.once("close",r),this._state!==zt)if(this._state=zt,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(we,this):process.nextTick(we,this);else{const i=this._server;this._removeListeners(),this._removeListeners=this._server=null,i.close(()=>{we(this)})}}shouldHandle(r){if(this.options.path){const i=r.url.indexOf("?");if((i!==-1?r.url.slice(0,i):r.url)!==this.options.path)return!1}return!0}handleUpgrade(r,i,o,f){i.on("error",Xt);const u=r.headers["sec-websocket-key"],h=+r.headers["sec-websocket-version"];if(r.method!=="GET"){ae(this,r,i,405,"Invalid HTTP method");return}if(r.headers.upgrade.toLowerCase()!=="websocket"){ae(this,r,i,400,"Invalid Upgrade header");return}if(!u||!Ji.test(u)){ae(this,r,i,400,"Missing or invalid Sec-WebSocket-Key header");return}if(h!==8&&h!==13){ae(this,r,i,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(r)){Ee(i,400);return}const l=r.headers["sec-websocket-protocol"];let m=new Set;if(l!==void 0)try{m=zi.parse(l)}catch{ae(this,r,i,400,"Invalid Sec-WebSocket-Protocol header");return}const _=r.headers["sec-websocket-extensions"],v={};if(this.options.perMessageDeflate&&_!==void 0){const y=new se(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const b=Ht.parse(_);b[se.extensionName]&&(y.accept(b[se.extensionName]),v[se.extensionName]=y)}catch{ae(this,r,i,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){const y={origin:r.headers[`${h===8?"sec-websocket-origin":"origin"}`],secure:!!(r.socket.authorized||r.socket.encrypted),req:r};if(this.options.verifyClient.length===2){this.options.verifyClient(y,(b,g,x,w)=>{if(!b)return Ee(i,g||401,x,w);this.completeUpgrade(v,u,m,r,i,o,f)});return}if(!this.options.verifyClient(y))return Ee(i,401)}this.completeUpgrade(v,u,m,r,i,o,f)}completeUpgrade(r,i,o,f,u,h,l){if(!u.readable||!u.writable)return u.destroy();if(u[Zi])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Yt)return Ee(u,503);const _=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Yi("sha1").update(i+Ki).digest("base64")}`],v=new this.options.WebSocket(null);if(o.size){const y=this.options.handleProtocols?this.options.handleProtocols(o,f):o.values().next().value;y&&(_.push(`Sec-WebSocket-Protocol: ${y}`),v._protocol=y)}if(r[se.extensionName]){const y=r[se.extensionName].params,b=Ht.format({[se.extensionName]:[y]});_.push(`Sec-WebSocket-Extensions: ${b}`),v._extensions=r}this.emit("headers",_,f),u.write(_.concat(`\r
`).join(`\r
`)),u.removeListener("error",Xt),v.setSocket(u,h,{maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(v),v.on("close",()=>{this.clients.delete(v),this._shouldEmitClose&&!this.clients.size&&process.nextTick(we,this)})),l(v,f)}}var en=Qi;function tn(n,r){for(const i of Object.keys(r))n.on(i,r[i]);return function(){for(const o of Object.keys(r))n.removeListener(o,r[o])}}function we(n){n._state=pr,n.emit("close")}function Xt(){this.destroy()}function Ee(n,r,i,o){i=i||je.STATUS_CODES[r],o={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(i),...o},n.once("finish",n.destroy),n.end(`HTTP/1.1 ${r} ${je.STATUS_CODES[r]}\r
`+Object.keys(o).map(f=>`${f}: ${o[f]}`).join(`\r
`)+`\r
\r
`+i)}function ae(n,r,i,o,f){if(n.listenerCount("wsClientError")){const u=new Error(f);Error.captureStackTrace(u,ae),n.emit("wsClientError",u,i,r)}else Ee(i,o,f)}const cn=Se(en);export{fn as Receiver,ln as Sender,un as WebSocket,cn as WebSocketServer,nn as createWebSocketStream,un as default};
